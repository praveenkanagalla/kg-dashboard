<div>
    <button class="back-all-employee-btn" (click)="openAllEmployee()">Back</button>
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="create-new-user">
        <div class="form-card">
            <h2>Create New User</h2>

            <div class="form-row">
                <div class="form-group">
                    <label>Name*</label>
                    <input formControlName="name" type="text" required />
                </div>

                <div class="form-group">
                    <label>Phone*</label>
                    <input formControlName="phone" type="text" required />
                </div>

                <div class="form-group">
                    <label>Department*</label>
                    <input formControlName="department" type="text" required />
                </div>

                <div class="form-group">
                    <label>PAN No</label>
                    <input formControlName="pan" type="text" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group full-width">
                    <label>Address</label>
                    <textarea formControlName="address" rows="2"></textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Country*</label>
                    <input formControlName="country" type="text" />
                </div>
                <div class="form-group">
                    <label>State*</label>
                    <input formControlName="state" type="text" />
                </div>
                <div class="form-group">
                    <label>City*</label>
                    <input formControlName="city" type="text" />
                </div>
                <div class="form-group">
                    <label>ZIP/Postal Code*</label>
                    <input formControlName="zip" type="text" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Bank Name</label>
                    <input formControlName="bank_name" type="text" />
                </div>
                <div class="form-group">
                    <label>Branch Name</label>
                    <input formControlName="branch_name" type="text" />
                </div>
                <div class="form-group">
                    <label>Account No</label>
                    <input formControlName="account_no" type="text" />
                </div>
                <div class="form-group">
                    <label>IFSC Code</label>
                    <input formControlName="ifsc_code" type="text" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Account Holder Name</label>
                    <input formControlName="account_holder" type="text" />
                </div>
                <div class="form-group">
                    <label>Working Branch</label>
                    <input formControlName="working_branch" type="text" />
                </div>
                <div class="form-group">
                    <label>Wages</label>
                    <input formControlName="wages" type="number" />
                </div>
            </div>

            <div class="form-row">
                <a class="auth-link" href="#" (click)="toggleAuthDetails(); $event.preventDefault()">
                    {{ showAuthFields ? 'Hide' : 'Add' }} Authentication Details
                </a>
            </div>

            <!-- Conditional Auth Fields -->
            <ng-container *ngIf="showAuthFields">
                <div class="form-row">
                    <div class="form-group">
                        <label>Email*</label>
                        <input formControlName="email" type="email" />
                    </div>

                    <div class="form-group">
                        <label>Password*</label>
                        <input formControlName="password" type="password" />
                    </div>


                    <div class="form-group">
                        <label>Role*</label>
                        <select formControlName="role" required>
                            <option value="" disabled>Select Role</option>
                            <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
                        </select>
                    </div>

                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Access Permissions*</label>
                        <div class="dropdown-checkbox">
                            <div class="dropdown-header" (click)="toggleDropdown()">
                                {{ selectedPermissionsLabel() }}
                                <span class="arrow">&#9662;</span>
                            </div>

                            <div class="dropdown-list" *ngIf="dropdownOpen">
                                <!-- Loop over filtered permissionsList -->
                                <label *ngFor="let perm of permissionsList">
                                    <input type="checkbox" [value]="perm.route"
                                        [checked]="(userForm.get('permissions')?.value || []).includes(perm.route)"
                                        (change)="onAccessChange($event)" />
                                    {{ perm.name }}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- Buttons -->
            <div class="form-actions">
                <button type="submit" class="save-btn">Save</button>
                <!-- [disabled]="userForm.invalid" -->
            </div>
        </div>
    </form>
</div>